---
title: μμ΅΄μ„±, μμ΅΄μ„± μ£Όμ…, μμ΅΄μ„± μ—­μ „μ μ›μΉ™
author: Cody
date: 2023-02-01 00:34:00 +0800
categories: [iOS, Dev Terms]
tags: [Swift, Clean Architecture]
pin: false
mermaid: true
---
μμ΅΄μ„±, μμ΅΄μ„± μ£Όμ…, μμ΅΄μ„± μ—­μ „μ— λ€ν•΄μ„ μ •λ¦¬ν•λ ¤κ³  ν•©λ‹λ‹¤.

## μμ΅΄μ„±

μ•„λμ™€ κ°™μ€ μ½”λ“κ°€ μμ„ λ•,

`Aν΄λμ¤λ” Bν΄λμ¤μ— μμ΅΄μ„±μ„ κ°–λ”λ‹¤`λΌκ³  ν•©λ‹λ‹¤.

```swift
class A {
    let b = B() // 'Aν΄λμ¤λ” Bν΄λμ¤μ— μμ΅΄μ„±μ„ κ°–λ”λ‹¤'
}

class B {

}
```

μ΄λ•Β κ°μ²΄ μΈμ¤ν„΄μ¤λ¥Ό μ‚¬μ©ν•λ” κ³³(A)μ„Β `ν΄λΌμ΄μ–ΈνΈ(Client)`λΌκ³  λ¶€λ¥΄κ³ ,

`μμ΅΄μ„±(a dependency)`μ€Β μ‚¬μ©λλ” κ°μ²΄ μΈμ¤ν„΄μ¤(B)λ¥Ό λ§ν•©λ‹λ‹¤.

`μμ΅΄μ„±μ΄ λ³€ν•λ©΄, ν΄λΌμ΄μ–ΈνΈμ— μν–¥μ„ λ―ΈμΉκ² λλ” κ΄€κ³„`μ…λ‹λ‹¤.

## μμ΅΄μ„± μ£Όμ…(Dependency Injection, DI)

μ„ μ½”λ“λ” μμ΅΄μ„±μ„ ν΄λΌμ΄μ–ΈνΈκ°€ μ§μ ‘ μΈμ¤ν„΄μ¤λ¥Ό λ§λ“¤κ³  μμµλ‹λ‹¤.

μ•„λμ™€ κ°™μ΄Β `μμ΅΄μ„±μ μΈμ¤ν„΄μ¤λ¥Ό μ™Έλ¶€λ΅λ¶€ν„° μƒμ„±ν•μ—¬ μ „λ‹¬λ°›λ” κ²ƒ`μ„Β `μμ΅΄μ„± μ£Όμ…`λΌκ³  λ¶€λ¦…λ‹λ‹¤.

```swift
class A {
    let b: B

    init(b: B) {
        self.b = b
    }
}
```

μ„μ™€ κ°™μ€ ν•νƒλ” μ•„λμ™€ κ°™μ€Β `μμ΅΄μ„± λ°©ν–¥`μ„ κ°€μ§€κ² λ©λ‹λ‹¤.
```mermaid
flowchart LR
    A --> B
```

μΆ€ λ” κµ¬μ²΄μ μΈ μμ‹λ¥Ό λ“¤μ–΄λ³΄κ² μµλ‹λ‹¤.

```swift
class Moving {
    func walking() {
        print("π¶π»π‘£π‘£π‘£π‘£")
    }

    func running() {
        print("πƒπ»β€β™‚οΈπ’¨π’¨π’¨π’¨")
    }
}

class Human {
    let moving: Moving

    init(move: Moving) {
        self.moving = move
    }

    func walking() {
        moving.walking()
    }

    func running() {
        moving.running()
    }
}
```

μ„ μ½”λ“λ”Β `Human`ν΄λμ¤κ°€Β `Moving`ν΄λμ¤μ— μμ΅΄μ„±μ„ κ°€μ§€κ³  μμµλ‹λ‹¤.
```mermaid
flowchart LR
    Human --> Moving
```

λ§μ•½ μ΄ μƒνƒμ—μ„Β `Moving`μ„Β `Human`μ΄ μ•„λ‹ λ‹¤λ¥Έ λ™λ¬Όμ—λ„ μ μ©μ„ ν•κ³  μ‹¶λ‹¤λ©΄ μ–΄λ–»κ² ν•΄μ•Ό ν• κΉμ”?

νΉμ€ λ‹¤λ¥Έ λ°©λ²•μΌλ΅ κ±·κ±°λ‚ λ‹¬λ¦¬λ”Β `Human`μ„ μ›ν•κ² λλ©΄?

`Moving`μ— λ‹¤λ¥Έ λ©”μ„λ“λ¥Ό μ¶”κ°€ν•κ±°λ‚? λ‹¤λ¥ΈΒ `Moving`μ„ λ§λ“¤μ–΄μ•Ό ν• κΉμ”? κ·Έλ¬κ³  λ‚λ©΄Β `Human`λ„ κ·Έμ— λ§μ¶° μμ •ν•΄μ•Όκ² μ£ ?

μ„μ™€ κ°™μ€ μμ΅΄κ΄€κ³„μ—μ„λ” μ μ—°ν•κ² λ³€ν™”λ¥Ό μ£ΌκΈ°κ°€ μ–΄λ µμµλ‹λ‹¤. λ³€ν™”μ— μ·¨μ•½ν•©λ‹λ‹¤.

## μμ΅΄μ„± μ—­μ „μ μ›μΉ™(Dependency Inversion Principle, DIP)

`SOLID`Β μ›μΉ™ μ¤‘μ— λ§μ§€λ§‰Β `D`μ— ν•΄λ‹Ήν•λ”Β `μμ΅΄μ„± μ—­μ „μ μ›μΉ™`μ΄ μμµλ‹λ‹¤.

μ΄λ”Β `μ¶”μƒν™”λ κ²ƒμ€ κµ¬μ²΄μ μΈ κ²ƒμ— μμ΅΄ν•λ©΄ μ• λκ³ , κµ¬μ²΄μ μΈ κ²ƒμ΄ μ¶”μƒν™”λ κ²ƒμ— μμ΅΄ν•΄μ•Ό ν•λ‹¤.`λΌλ” μ›μΉ™μ…λ‹λ‹¤.

μ„ μμ‹κ°€ λ³€ν™”μ— μ·¨μ•½ν–λ μ΄μ λ”Β `κµ¬μ²΄μ μΈ κ²ƒμ— μμ΅΄ν–κΈ° λ•λ¬Έ`μ…λ‹λ‹¤.

κ·Έλ ‡λ‹¤λ©΄ μ–΄λ–»κ² μ½”λ“λ¥Ό κ°μ„ ν•  μ μμ„κΉμ”?

`Swift`μ—μ„λ”Β `Protocol`μ„ ν†µν•΄μ„ μ¶”μƒν™”λ κ°μ²΄λ¥Ό ν‘ν„ν•  μ μμµλ‹λ‹¤.

μ΄Β `Protocol`μ„ ν†µν•΄μ„Β `κµ¬μ²΄μ μΈ κ²ƒμ΄ μ¶”μƒν™”λ κ²ƒμ— μμ΅΄`ν•λ„λ΅ κ°μ„ μ„ ν•΄λ΄…μ‹λ‹¤.

```swift
// Movingμ„ protocolλ΅ μ¶”μƒν™”
protocol Moving {
    func walking()
		func running()
}
```

```swift
// μ¶”μƒν™”λ MovingμΌλ΅ λ‹¤μ–‘ν• Movingμ„ μ‘μ„±
class HumanMoving: Moving {
    func walking() {
        print("π¶π»π‘£π‘£π‘£π‘£")
    }

    func running() {
        print("πƒπ»β€β™‚οΈπ’¨π’¨π’¨π’¨")
    }
}

class HumanMoving2: Moving {
    func walking() {
        print("π§‘π»β€π¦―π‘£π‘£π‘£π‘£")
    }

    func running() {
        print("π§‘π»β€π¦½β½β½β½β½")
    }
}
```

```swift
class Human {
    var moving: Moving

    init(move: Moving) {
        self.moving = move
    }

    func walking() {
        moving.walking()
    }

    func running() {
        moving.running()
    }
}

let human = Human(move: HumanMoving())
human.walking()// π¶π»π‘£π‘£π‘£π‘£
human.running()// πƒπ»β€β™‚οΈπ’¨π’¨π’¨π’¨
```

μ„μ™€ κ°™μ΄ μ‘μ„±μ΄ λλ©΄Β `Human`μ€ λ‹¤μ–‘ν• λ°©λ²•μΌλ΅Β `Moving`μ„ ν•  μ μκ² λμ—μµλ‹λ‹¤.

```swift
human.moving = HumanMoving2()
human.walking()// π§‘π»β€π¦―π‘£π‘£π‘£π‘£
human.running()// π§‘π»β€π¦½β½β½β½β½
```

μ•±μ΄ λ™μ‘ν•λ” μ¤‘μ—λ„ μ–Όλ§λ“ μ§€ μƒλ΅μ΄Β `Moving`μ„ μ£Όμ…ν•΄μ„ λ‹¤λ¥Έ λ™μ‘μ„ ν•  μ μλ„λ΅ μ μ—°ν•΄μ§€κ² λμ—μµλ‹λ‹¤.

μ €Β `Moving`μ€ λ‹¤λ¥Έ λ™λ¬Όμ—λ„ μ‚¬μ©ν•  μ μμµλ‹λ‹¤.

```swift
class CatMoving: Moving {
    func walking() {
        print("ππΎπΎπΎπΎ")
    }

    func running() {
        print("ππ’¨π’¨π’¨π’¨")
    }
}

class Cat {
    let moving: Moving

    init(move: Moving) {
        self.moving = move
    }

    func walking() {
        moving.walking()
    }

    func running() {
        moving.running()
    }
}

let cat = Cat(move: CatMoving())
cat.walking()
cat.running()
```

μ„ μμ‹λ“¤μΒ `μμ΅΄μ„± λ°©ν–¥`μ€ μ•„λμ™€ κ°™μ΄ λ°”λ€μ—μµλ‹λ‹¤.
```mermaid
flowchart LR
    Human --> Moving:::abstract
    HumanMoving --> Moving

    classDef abstract stroke:#ff,stroke-width:2px,color:#fff,stroke-dasharray: 3 3
```
```mermaid
flowchart LR
    Cat --> Moving:::abstract
    CatMoving --> Moving

    classDef abstract stroke:#ff,stroke-width:2px,color:#fff,stroke-dasharray: 3 3
```


`κµ¬μ²΄μ μΈ κ²ƒ(Human, HumanMoving)μ΄ μ¶”μƒν™”λ κ²ƒ(Moving)μ— μμ΅΄ν•λ” λ°©ν–¥`μ΄ λμ—μ£ ?

μ΄λ ‡κ² μμ΅΄μ„± λ°©ν–¥μ„ λ°”κΏ”μ£Όμ–΄ μΆ€ λ” μ μ—°ν• μ½”λ“κ°€ λλ„λ΅ λ§λ“¤μ–΄μ£Όλ” κ²ƒμ„Β `μμ΅΄μ„± μ—­μ „(Dependency Inversion)`μ΄λΌκ³  ν•©λ‹λ‹¤.

## μμ΅΄μ„± μ£Όμ…μ λ°©λ²•λ“¤

μμ΅΄μ„± μ£Όμ…μ—” μ—¬λ¬ κ°€μ§€ λ°©λ²•κ³Ό μ¥λ‹¨μ μ΄ μμµλ‹λ‹¤.

λ¨λ‘ μ°λ¦¬κ°€ μµμ™ν•κ² μ¨μ™”λ λ°©λ²•λ“¤μ…λ‹λ‹¤.

### 1. Constructor Injection

ν΄λΌμ΄μ–ΈνΈμ μƒμ„±μλ΅λ¶€ν„° μμ΅΄μ„±μ„ μ£Όμ…λ°›λ” λ°©λ²•μ…λ‹λ‹¤.

μ΄ λ°©λ²•μ€ μ†μ¤λ¥Ό μ‘μ„±ν•  λ• ν΄λΌμ΄μ–ΈνΈ μ΄κΈ°ν™” μ‹Β `μ–΄λ–¤ μμ΅΄μ„±μ„ κ°€μ§€κ³  μλ”μ§€ λ…ν™•ν•κ² μ•λ ¤μ£Όλ” μ¥μ `μ΄ μμµλ‹λ‹¤.

μμ΅΄μ„±μ„Β `private let`μΌλ΅ ν•λ©΄ μ΄κΈ°ν™” ν›„ μμ΅΄μ„±μ— μν• λ™μ‘μ΄ μΌκ΄€μ„± μλ„λ΅ ν†µμ ν•  μ μμµλ‹λ‹¤.

```swift
class Human {
    private let moving: Moving

    init(move: Moving) {
        self.moving = move
    }

    func walking() {
        moving.walking()
    }

    func running() {
        moving.running()
    }
}

let human = Human(move: HumanMoving())
human.walking()// π¶π»π‘£π‘£π‘£π‘£
human.running()// πƒπ»β€β™‚οΈπ’¨π’¨π’¨π’¨
```

### 2. Property Injection, Method Injection

μμ΅΄μ„±μ„Β `property`Β νΉμ€Β `Method`λ΅ μ£Όμ…ν•λ” λ°©λ²•μ…λ‹λ‹¤.

ν΄λΌμ΄μ–ΈνΈ μƒμ„± μ΄ν›„ μ£Όμ…ν•¨μΌλ΅μ¨ μ›ν•λ” λ™μ‘μ„ ν•λ„λ΅ λ³€κ²½μ‹μΌ μ¤„ μ μμµλ‹λ‹¤.

μ°λ¦¬κ°€Β `DateFormatter`λ¥Ό μ‚¬μ© μ‹Β `DateFormat`μ„ μ„Έν…ν•΄μ£Όλ” ν¨ν„΄κ³Ό κ°™μ€ μμ‹κ°€ μμµλ‹λ‹¤.

μ΄λ” ν΄λΌμ΄μ–ΈνΈλ¥Ό μ‚¬μ©ν•  λ• κ°λ°μκ°€ μμ΅΄μ„± μ£Όμ…μ„ μμ§€ λ§μ•„μ•Ό μλ„ν• λ€λ΅ λ™μ‘ν•κ² ν•  μ μμµλ‹λ‹¤.

```swift
class Human {
    var moving: Moving

    init(move: Moving) {
        self.moving = move
    }

    func walking() {
        moving.walking()
    }

    func running() {
        moving.running()
    }

    func setMoving(_ move: Moving) {
    	self.moving = move
    }
}

let human = Human(move: HumanMoving()) // Constructor Injection
human.walking() // π¶π»π‘£π‘£π‘£π‘£
human.running() // πƒπ»β€β™‚οΈπ’¨π’¨π’¨π’¨

human.moving = HumanMoving2() // Property Injection
human.walking() // π§‘π»β€π¦―π‘£π‘£π‘£π‘£
human.running() // π§‘π»β€π¦½π’¨π’¨π’¨π’¨

human.setMoving(_ move: HumanMoving()) // Method Injection
human.walking() // π¶π»π‘£π‘£π‘£π‘£
human.running() // πƒπ»β€β™‚οΈπ’¨π’¨π’¨π’¨
```

### 3. Interface Injection

μμ΅΄μ„± μ£Όμ…μ μ—­ν• μ„Β `protocol`λ΅ μ¶”μƒν™”ν•λ” λ°©λ²•μ…λ‹λ‹¤.

```swift
protocol MovingDependant {
    func setMoving(_ move: Moving)
}

class Human: MovingDependant {
    var moving: Moving

    init(move: Moving) {
        self.moving = move
    }

    func walking() {
        moving.walking()
    }

    func running() {
        moving.running()
    }

    func setMoving(_ move: Moving) {
    	self.moving = move
    }
}

let human = Human(move: HumanMoving())
human.walking() // π¶π»π‘£π‘£π‘£π‘£
human.running() // πƒπ»β€β™‚οΈπ’¨π’¨π’¨π’¨

human.setMoving(HumanMoving())
human.walking() // π¶π»π‘£π‘£π‘£π‘£
human.running() // πƒπ»β€β™‚οΈπ’¨π’¨π’¨π’¨
```

---

μ—¬κΈ°κΉμ§€κ°€ μμ΅΄μ„± μ£Όμ…μ— λ€ν• νΉμ§•λ“¤μ΄μ—λ”λ°μ”.

## μμ΅΄μ„± μ£Όμ…μΌλ΅ μ–»μ„Β μ μλ” κ²ƒ

### 1.Β μ λ‹›ν…μ¤νΈλ¥Ό ν•  λ•, ν…μ¤νΈκ°€ μ©μ΄ν•  μ μμµλ‹λ‹¤.

μ•„λμ™€ κ°™μ΄Β `Request`λ¥Ό ν†µν•΄ μ–΄λ–¤ λ°μ΄ν„°λ¥Ό λ°›μ•„μ¤λ” μ‘μ—…μ΄ μμ„ λ•,

```swift
protocol Serializer {
    func serialize(data: Any) -> Data?
}

class RequestSerializer: Serializer {
    func serialize(data: Any) -> Data? {
        // Requestλ¥Ό ν†µν•΄ λ¬΄μ–Έκ°€λ¥Ό λ°›μ•„μ¤λ” μ‘μ—…
        return nil
    }
}

class DataManager {
    var serializer: Serializer

    init(serializer: Serializer) {
        self.serializer = serializer
    }
}
```

μ°λ¦¬λ” μ•„λμ™€ κ°™μ΄Β `Mock`Β κ°μ²΄λ¥Ό λ€μ‹  μ£Όμ…ν•μ—¬ μ λ‹›ν…μ¤νΈλ¥Ό ν†µμ ν•  μ μκ² λ©λ‹λ‹¤.

```swift
class MockSerializer: Serializer {
    func serialize(data: Any) -> Data? {
        return Data(base64Encoded: "Mock Data") // λ°λ―Έλ°μ΄ν„°
    }
}
```

### 2. κ·Έλ¦¬κ³  ν΄λΌμ΄μ–ΈνΈ(`DataManager`, `Human`)μ μμ •μ—†μ΄ μ‰½κ² λ‹¤λ¥Έ ν•νƒμ ν΄λΌμ΄μ–ΈνΈλ¥Ό λ§λ“¤ μ μκ² λ©λ‹λ‹¤.

μ£Όμ…μ‹μΌ μ£Όλ” μμ΅΄μ„±(`Serializer`, `Moving`)μ— λ”°λΌμ„ ν΄λΌμ΄μ–ΈνΈ ν•¨μ(`serialize(data:)->Data, walking(), running()`)κ°€ λ‹¤λ¥΄κ² λ™μ‘ν•λ„λ΅ λ§λ“¤μ–΄μ¤„ μ μμµλ‹λ‹¤.

μμ΅΄μ„± κ°μ²΄μ μƒμ„±κ³Όμ •μ΄ λ°”λ€λ”λΌλ„ ν΄λΌμ΄μ–ΈνΈ μ½”λ“μ— μν–¥μ„ μ£Όμ§€ μ•μ•„Β `μ½”λ“ μ¬μ‚¬μ©μ„±`μ„ λ†’μ—¬μ¤λ‹λ‹¤.

### 3. ν΄λΌμ΄μ–ΈνΈλ”Β `protocol`Β μΈν„°νμ΄μ¤λ΅λ§ κ°μ²΄λ¥Ό μ•κ³  μμμΌλ΅μ¨Β `λ³΄λ‹¤ λ‚μ€ μ„¤κ³„`λ¥Ό ν•  μ μκ² λ©λ‹λ‹¤.

`μ¶”μƒν™”κ°€ λ” μ‰¬μ›μ§€λ©°, λ¨λ“λ³„ μμ΅΄μ„±μ„ λ–Όμ–΄λ‚΄λ”λ° μ©μν•΄μ§‘λ‹λ‹¤.`

μμ΅΄μ„± μ£Όμ…μ€Β `Singleton`μ ν•„μ”μ„±μ„ μ¤„μ΄λ” μΆ‹μ€ ν¨ν„΄μ…λ‹λ‹¤.Β `Singleton`μ€ κ°€λ¥ν• ν”Όν•λ” κ²ƒμ΄ μΆ‹μµλ‹λ‹¤.

`Singleton`μ€ κ²°ν•©λ„λ¥Ό μ¦κ°€μ‹ν‚¤μ§€λ§ μμ΅΄μ„± μ£Όμ…μ€ κ²°ν•©λ„λ¥Ό λ‚®μ¶°μ¤λ‹λ‹¤.

μμ΅΄μ„± μ£Όμ…μ„ ν†µν•΄ ν•΄λ‹Ή κ°μ²΄κ°€ μ–΄λ–¤ μμ΅΄μ„±μ„ κ°–λ”μ§€ νμ•…ν•κΈ° μ‰¬μ°λ©° μ±…μ„ λν• μ• μ μκ² ν•΄μ£Όμ–΄Β λ³µμ΅ν• ν”„λ΅μ νΈλ¥Ό νμ•…ν•λ”λ° λ„μ›€μ„ μ¤„ μλ„ μμµλ‹λ‹¤.